<%- include('partials/header') %>

<!-- Modern Products Page -->
<section class="products-page">
    <div class="container">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-title">Ürünlerimiz</h1>
            <p class="page-subtitle">Kaliteli ve sağlıklı Silver Wyandotte damızlıklarımızı keşfedin</p>
        </div>

        <!-- Search and Filters -->
        <div class="search-filters-bar">
            <form action="/urunler" method="GET" class="search-form">
                <div class="search-item">
                    <label class="search-label">Arama</label>
                    <div class="search-input-wrapper">
                        <i class="bi bi-search search-icon"></i>
                        <input type="text" name="search" class="search-input" placeholder="Ürün ara..." value="<%= searchTerm || '' %>">
                    </div>
                </div>
                <button type="submit" class="search-btn">
                    <i class="bi bi-search"></i>
                    <span>Ara</span>
                </button>
            </form>
            
            <div class="filters-wrapper">
                <div class="filter-item">
                    <label class="filter-label">Kategori</label>
                    <select class="filter-select" onchange="filterProducts()">
                        <option value="">Tümü</option>
                        <option value="tavuk">Tavuk</option>
                        <option value="horoz">Horoz</option>
                        <option value="civciv">Civciv</option>
                    </select>
                </div>
                
                <div class="filter-item">
                    <label class="filter-label">Fiyat</label>
                    <select class="filter-select" onchange="filterProducts()">
                        <option value="">Tümü</option>
                        <option value="0-500">0 - 500 ₺</option>
                        <option value="500-1000">500 - 1000 ₺</option>
                        <option value="1000-2000">1000 - 2000 ₺</option>
                        <option value="2000+">2000+ ₺</option>
                    </select>
                </div>
                
                <div class="filter-item">
                    <label class="filter-label">Sırala</label>
                    <select class="filter-select" onchange="sortProducts()">
                        <option value="name">İsme Göre</option>
                        <option value="price-low">Fiyat (Düşük-Yüksek)</option>
                        <option value="price-high">Fiyat (Yüksek-Düşük)</option>
                        <option value="stock">Stok Durumu</option>
                    </select>
                </div>
            </div>
        </div>
        
        <% if (urunler && urunler.length > 0) { %>
            <div class="products-grid">
                <% urunler.forEach(function(urun, index) { %>
                    <% 
                        // Assign categories based on product name or create test categories
                        let category = 'tavuk';
                        if (urun.isim && urun.isim.toLowerCase().includes('horoz')) {
                            category = 'horoz';
                        } else if (urun.isim && urun.isim.toLowerCase().includes('civciv')) {
                            category = 'civciv';
                        } else if (urun.kategori) {
                            category = urun.kategori.toLowerCase();
                        } else {
                            // Assign test categories based on index
                            const categories = ['tavuk', 'horoz', 'civciv', 'tavuk', 'horoz', 'civciv'];
                            category = categories[index % categories.length];
                        }
                    %>
                    <div class="product-card" data-category="<%= category %>">
                        <div class="product-image">
                            <img src="<%= urun.resim %>" alt="<%= urun.isim %>" loading="lazy">
                            <div class="product-overlay">
                                <div class="overlay-content">
                                    <a href="/product/<%= urun._id %>" class="btn btn-primary">
                                        <i class="bi bi-eye"></i>
                                        <span>Detayları Gör</span>
                                    </a>
                                    <button class="btn btn-outline-light quick-view" data-product="<%= urun._id %>">
                                        <i class="bi bi-zoom-in"></i>
                                        <span>Hızlı Görünüm</span>
                                    </button>
                                </div>
                            </div>
                            <div class="product-badges">
                                <% if (urun.stok > 10) { %>
                                    <span class="badge premium">
                                        <i class="bi bi-star-fill"></i>
                                        <span>Premium</span>
                                    </span>
                                <% } else if (urun.stok > 0) { %>
                                    <span class="badge limited">
                                        <i class="bi bi-exclamation-triangle"></i>
                                        <span>Az Kaldı</span>
                                    </span>
                                <% } else { %>
                                    <span class="badge out-of-stock">
                                        <i class="bi bi-x-circle"></i>
                                        <span>Stok Yok</span>
                                    </span>
                                <% } %>
                                <% if (urun.isFeatured) { %>
                                    <span class="badge featured">
                                        <i class="bi bi-heart-fill"></i>
                                        <span>Öne Çıkan</span>
                                    </span>
                                <% } %>
                            </div>
                            <div class="product-top-actions">
                                <button class="top-action-btn wishlist" data-product="<%= urun._id %>" title="Favorilere Ekle">
                                    <i class="bi bi-heart"></i>
                                </button>
                                <button class="top-action-btn compare" data-product="<%= urun._id %>" title="Karşılaştır">
                                    <i class="bi bi-arrow-left-right"></i>
                                </button>
                            </div>
                        </div>
                        <div class="product-info">
                            <h3 class="product-name"><%= urun.isim %></h3>
                            <p class="product-description"><%= urun.aciklama %></p>
                            
                            <div class="product-rating">
                                <div class="stars">
                                    <% 
                                        const rating = urun.averageRating || 0;
                                        const fullStars = Math.floor(rating);
                                        const hasHalfStar = rating % 1 >= 0.5;
                                        const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
                                    %>
                                    <% for (let i = 0; i < fullStars; i++) { %>
                                        <i class="bi bi-star-fill"></i>
                                    <% } %>
                                    <% if (hasHalfStar) { %>
                                        <i class="bi bi-star-half"></i>
                                    <% } %>
                                    <% for (let i = 0; i < emptyStars; i++) { %>
                                        <i class="bi bi-star"></i>
                                    <% } %>
                                </div>
                                <span class="rating-text">(<%= urun.reviewCount || 0 %> değerlendirme)</span>
                            </div>
                            
                            <div class="product-price">
                                <span class="price-current"><%= urun.fiyat %> ₺</span>
                                <% if (urun.stok > 0) { %>
                                    <span class="price-old"><%= (urun.fiyat * 1.2).toFixed(0) %> ₺</span>
                                <% } %>
                            </div>
                            
                            <div class="product-stock">
                                <div class="stock-info">
                                    <i class="bi bi-check-circle"></i>
                                    <span>Stok: <%= urun.stok %> adet</span>
                                </div>
                                <div class="stock-bar">
                                    <div class="stock-fill" style="width: <%= Math.min((urun.stok / 20) * 100, 100) %>%"></div>
                                </div>
                            </div>
                            
                            
                            <div class="product-footer">
                                <% if (urun.stok > 0) { %>
                                    <button class="btn-add-cart" data-product="<%= urun._id %>">
                                        <i class="bi bi-cart-plus"></i>
                                        <span>Sepete Ekle</span>
                                    </button>
                                <% } else { %>
                                    <button class="btn-out-of-stock" disabled>
                                        <i class="bi bi-x-circle"></i>
                                        <span>Stok Yok</span>
                                    </button>
                                <% } %>
                            </div>
                        </div>
                    </div>
                <% }); %>
            </div>
            
            <!-- Pagination -->
            <% if (totalPages > 1) { %>
                <div class="pagination-container">
                    <nav class="pagination">
                        <% if (currentPage > 1) { %>
                            <a href="?page=<%= currentPage - 1 %>" class="page-btn prev">
                                <i class="bi bi-chevron-left"></i>
                                <span>Önceki</span>
                            </a>
                        <% } %>
                        
                        <div class="page-numbers">
                            <% for (let i = Math.max(1, currentPage - 2); i <= Math.min(totalPages, currentPage + 2); i++) { %>
                                <a href="?page=<%= i %>" class="page-number <%= i === currentPage ? 'active' : '' %>">
                                    <%= i %>
                                </a>
                            <% } %>
                        </div>
                        
                        <% if (currentPage < totalPages) { %>
                            <a href="?page=<%= currentPage + 1 %>" class="page-btn next">
                                <span>Sonraki</span>
                                <i class="bi bi-chevron-right"></i>
                            </a>
                        <% } %>
                    </nav>
                </div>
            <% } %>
        <% } else { %>
            <div class="no-products">
                <div class="no-products-icon">
                    <i class="bi bi-search"></i>
                </div>
                <h3>Ürün Bulunamadı</h3>
                <p>Aradığınız kriterlere uygun ürün bulunamadı. Lütfen farklı anahtar kelimeler deneyin.</p>
                <a href="/urunler" class="btn btn-primary">
                    <i class="bi bi-arrow-clockwise"></i>
                    <span>Tüm Ürünleri Gör</span>
                </a>
            </div>
        <% } %>
    </div>
</section>

<%- include('partials/footer') %>