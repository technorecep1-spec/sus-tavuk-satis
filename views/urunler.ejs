<%- include('partials/header') %>

<div class="main-content">
    <h1>Ürünlerimiz</h1>
    <div class="search-container">
        <form action="/urunler" method="GET" class="search-form">
            <input type="text" name="search" placeholder="Ürün ara..." class="search-input" value="<%= searchTerm %>">
            <button type="submit" class="search-button">Ara</button>
        </form>
    </div>
    <% if (urunler && urunler.length > 0) { %>
        <div class="row row-cols-1 row-cols-md-3 row-cols-lg-4 g-4">
            <% urunler.forEach(function(urun) { %>
                <div class="col">
                    <div class="card h-100 shadow-sm">
                        <a href="/product/<%= urun._id %>" class="product-link">
                            <img src="<%= urun.resim %>" class="card-img-top" alt="<%= urun.isim %>" style="aspect-ratio: 4/3; object-fit: cover;">
                        </a>
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title"><%= urun.isim %></h5>
                            <p class="card-text text-muted flex-grow-1"><%= urun.aciklama.substring(0, 80) %>...</p>
                            <h4 class="price text-end"><%= formatPrice(urun.fiyat) %></h4>
                        </div>
                        <div class="card-footer bg-transparent border-top-0">
                            <% if (urun.stok > 0) { %>
                                <form action="/cart/add" method="POST">
                                    <input type="hidden" name="productId" value="<%= urun._id %>">
                                    <div class="input-group">
                                        <input type="number" name="quantity" class="form-control" value="1" min="1" max="<%= urun.stok %>" style="max-width: 70px;">
                                        <button type="submit" class="btn btn-primary">Sepete Ekle</button>
                                    </div>
                                </form>
                                <p class="text-success small mt-2 mb-0">Stokta: <%= urun.stok %> Adet</p>
                            <% } else { %>
                                <button type="button" class="btn btn-secondary w-100" disabled>Stok Tükendi</button>
                                <p class="text-danger small mt-2 mb-0">Stok Tükendi</p>
                            <% } %>
                        </div>
                    </div>
                </div>
            <% }); %>
        </div>
    <% } else { %>
        <% if (searchTerm) { %>
            <p>"<%= searchTerm %>" için arama sonucu bulunamadı.</p>
        <% } else { %>
            <p>Şu anda satışta ürün bulunmamaktadır.</p>
        <% } %>
    <% } %>
    </div>

<%- include('partials/footer') %>