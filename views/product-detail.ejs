<%- include('partials/header') %>

<div class="main-content">
    <div class="card shadow-sm p-4">
        <div class="row g-5">
            <div class="col-md-6">
                <img src="<%= urun.resim %>" alt="<%= urun.isim %>" class="img-fluid rounded">
            </div>
            
            <div class="col-md-6 d-flex flex-column">
                <h1 class="display-6"><%= urun.isim %></h1>
                <p class="lead text-muted"><%= urun.aciklama %></p>
                <h2 class="price my-3"><%= formatPrice(urun.fiyat) %></h2>

                <div class="mt-auto">
                    <% if (urun.stok > 0) { %>
                        <p class="text-success">Stokta: <%= urun.stok %> Adet</p>
                        <form action="/cart/add" method="POST">
                            <input type="hidden" name="productId" value="<%= urun._id %>">
                            <div class="input-group">
                                <input type="number" name="quantity" class="form-control" value="1" min="1" max="<%= urun.stok %>" style="max-width: 100px;">
                                <button type="submit" class="btn btn-primary">Sepete Ekle</button>
                            </div>
                        </form>
                    <% } else { %>
                        <p class="text-danger">Stok Tükendi</p>
                        <button type="button" class="btn btn-secondary" disabled>Stok Tükendi</button>
                    <% } %>
                </div>
            </div>
        </div>
    </div>

    <hr class="my-5">

    <div class="row g-5">
        <div class="col-md-7">
            <div class="review-section">
                <h3>Ürün Değerlendirmeleri</h3>
                <% if (reviews && reviews.length > 0) { %>
                    <% reviews.forEach(review => { %>
                        <div class="review-card">
                            <p>
                                <strong><i class="bi bi-person-circle"></i> <%= review.user.email.split('@')[0] %></strong>
                                <span class="text-muted">- Puan: <%= review.rating %> / 5</span>
                            </p>
                            <p><%= review.comment %></p>
                            <small class="text-muted"><%= new Date(review.createdAt).toLocaleDateString('tr-TR') %></small>
                        </div>
                    <% }); %>
                <% } else { %>
                    <p>Bu ürün için henüz bir değerlendirme yapılmamış.</p>
                <% } %>
            </div>
        </div>

        <div class="col-md-5">
            <div class="review-section">
                <h3>Bu Ürünü Değerlendir</h3>
                <% if (user) { %>
                    <form action="/product/<%= urun._id %>/review" method="POST" class="user-form">
                        <div class="mb-3">
                            <label for="rating" class="form-label">Puanınız (1-5):</label>
                            <select name="rating" id="rating" class="form-select" required>
                                <option value="5">5 - Mükemmel</option>
                                <option value="4">4 - Çok İyi</option>
                                <option value="3" selected>3 - İyi</option>
                                <option value="2">2 - Kötü</option>
                                <option value="1">1 - Çok Kötü</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="comment" class="form-label">Yorumunuz:</label>
                            <textarea name="comment" id="comment" rows="4" class="form-control" required></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Yorumu Gönder</button>
                    </form>
                <% } else { %>
                    <p class="mt-3">Yorum yapabilmek için <a href="/login">giriş yapmanız</a> gerekmektedir.</p>
                <% } %>
            </div>
        </div>
    </div>
</div>

<%- include('partials/footer') %>