<%- include('partials/header') %>

<!-- Advanced Product Detail Page -->
<section class="product-detail-page">
    <div class="container">
        <!-- Breadcrumb -->
        <nav class="breadcrumb-nav">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/">Ana Sayfa</a></li>
                <li class="breadcrumb-item"><a href="/urunler">Ürünler</a></li>
                <li class="breadcrumb-item active">Silver Wyandotte</li>
            </ol>
        </nav>

        <!-- Product Main Section -->
        <div class="product-main">
            <div class="row g-5">
                <!-- Product Images -->
                <div class="col-lg-6">
                    <div class="product-gallery">
                        <div class="main-image">
                            <img src="<%= urun.resim %>" alt="<%= urun.isim %>" class="img-fluid" id="mainImage">
                            <div class="image-overlay">
                                <button class="zoom-btn" onclick="openImageModal('<%= urun.resim %>')">
                                    <i class="bi bi-zoom-in"></i>
                                </button>
                            </div>
                        </div>
                        <div class="image-thumbnails">
                            <img src="<%= urun.resim %>" alt="<%= urun.isim %>" class="thumbnail active" onclick="changeMainImage('<%= urun.resim %>')">
                            <!-- Additional thumbnails can be added here -->
                        </div>
                    </div>
                </div>

                <!-- Product Info -->
                <div class="col-lg-6">
                    <div class="product-info">
                        <div class="product-badges">
                            <% if (urun.stok > 10) { %>
                                <span class="badge premium">
                                    <i class="bi bi-star-fill"></i>
                                    Premium
                                </span>
                            <% } else if (urun.stok > 0) { %>
                                <span class="badge limited">
                                    <i class="bi bi-exclamation-triangle"></i>
                                    Sınırlı Stok
                                </span>
                            <% } %>
                            <% if (urun.fiyat > 1000) { %>
                                <span class="badge discount">
                                    <i class="bi bi-percent"></i>
                                    %20 İndirim
                                </span>
                            <% } %>
                        </div>

                        <div class="product-category">Silver Wyandotte</div>
                        <h1 class="product-title"><%= urun.isim %></h1>
                        
                        <div class="product-rating">
                            <div class="stars">
                                <i class="bi bi-star-fill"></i>
                                <i class="bi bi-star-fill"></i>
                                <i class="bi bi-star-fill"></i>
                                <i class="bi bi-star-fill"></i>
                                <i class="bi bi-star-half"></i>
                            </div>
                            <span class="rating-text">
                                <% 
                                    const avgRating = reviews && reviews.length > 0 ? 
                                        (reviews.reduce((sum, review) => sum + review.rating, 0) / reviews.length).toFixed(1) : 
                                        '4.8';
                                %>
                                (<%= avgRating %>) <%= reviews ? reviews.length : '0' %> değerlendirme
                            </span>
                        </div>

                        <div class="product-price-container">
                            <div class="current-price neon-text"><%= formatPrice(urun.fiyat) %></div>
                            <% if (urun.fiyat > 1000) { %>
                                <div class="original-price">₺<%= Math.round(urun.fiyat * 1.2) %>,00</div>
                            <% } %>
                        </div>

                        <div class="product-features">
                            <div class="feature">
                                <i class="bi bi-shield-check text-success"></i>
                                <span>Sağlık Garantisi</span>
                            </div>
                            <div class="feature">
                                <i class="bi bi-truck text-primary"></i>
                                <span>Ücretsiz Kargo</span>
                            </div>
                            <div class="feature">
                                <i class="bi bi-arrow-clockwise text-info"></i>
                                <span>30 Gün İade</span>
                            </div>
                        </div>

                        <div class="product-stock">
                            <div class="stock-indicator">
                                <div class="stock-bar">
                                    <% 
                                        let stockPercentage = 0;
                                        if (urun.stok > 0) {
                                            stockPercentage = Math.min((urun.stok / 50) * 100, 100);
                                        }
                                    %>
                                    <div class="stock-fill" style="width: <%= stockPercentage %>%"></div>
                                </div>
                                <% if (urun.stok > 0) { %>
                                    <span class="stock-text">Stokta <%= urun.stok %> adet kaldı</span>
                                <% } else { %>
                                    <span class="stock-text text-danger">Stok Tükendi</span>
                                <% } %>
                            </div>
                        </div>

                        <% if (urun.stok > 0) { %>
                            <form action="/cart/add" method="POST" class="add-to-cart-form">
                                <input type="hidden" name="productId" value="<%= urun._id %>">
                                <div class="quantity-selector">
                                    <button type="button" class="qty-btn minus" onclick="decreaseQuantity()">-</button>
                                    <input type="number" name="quantity" id="quantity" class="quantity-input" value="1" min="1" max="<%= urun.stok %>">
                                    <button type="button" class="qty-btn plus" onclick="increaseQuantity()">+</button>
                                </div>
                                <button type="submit" class="btn btn-primary add-to-cart-btn">
                                    <i class="bi bi-cart-plus"></i>
                                    <span>Sepete Ekle</span>
                                </button>
                            </form>
                        <% } else { %>
                            <button type="button" class="btn btn-secondary w-100" disabled>
                                <i class="bi bi-x-circle"></i>
                                <span>Stok Tükendi</span>
                            </button>
                        <% } %>

                        <div class="product-actions">
                            <button class="action-btn wishlist" onclick="toggleWishlist('<%= urun._id %>')">
                                <i class="bi bi-heart"></i>
                                <span>Favorilere Ekle</span>
                            </button>
                            <button class="action-btn compare" onclick="toggleCompare('<%= urun._id %>')">
                                <i class="bi bi-arrow-left-right"></i>
                                <span>Karşılaştır</span>
                            </button>
                            <button class="action-btn share" onclick="shareProduct()">
                                <i class="bi bi-share"></i>
                                <span>Paylaş</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Product Details Tabs -->
        <div class="product-tabs">
            <div class="tab-navigation">
                <button class="tab-btn active" data-tab="description">
                    <i class="bi bi-info-circle"></i>
                    <span>Ürün Açıklaması</span>
                </button>
                <button class="tab-btn" data-tab="reviews">
                    <i class="bi bi-star"></i>
                    <span>Değerlendirmeler (<%= reviews ? reviews.length : '0' %>)</span>
                </button>
                <button class="tab-btn" data-tab="shipping">
                    <i class="bi bi-truck"></i>
                    <span>Kargo & Teslimat</span>
                </button>
            </div>

            <div class="tab-content">
                <!-- Description Tab -->
                <div class="tab-pane active" id="description">
                    <div class="tab-content-inner">
                        <h3>Ürün Detayları</h3>
                        <p><%= urun.aciklama %></p>
                        
                        <div class="product-specs">
                            <h4>Özellikler</h4>
                            <div class="specs-grid">
                                <div class="spec-item">
                                    <span class="spec-label">Cins:</span>
                                    <span class="spec-value">Silver Wyandotte</span>
                                </div>
                                <div class="spec-item">
                                    <span class="spec-label">Yaş:</span>
                                    <span class="spec-value">6-12 ay</span>
                                </div>
                                <div class="spec-item">
                                    <span class="spec-label">Cinsiyet:</span>
                                    <span class="spec-value">Dişi</span>
                                </div>
                                <div class="spec-item">
                                    <span class="spec-label">Ağırlık:</span>
                                    <span class="spec-value">2.5-3 kg</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reviews Tab -->
                <div class="tab-pane" id="reviews">
                    <div class="tab-content-inner">
                        <div class="reviews-summary">
                            <div class="rating-overview">
                                <div class="average-rating">
                                    <span class="rating-number"><%= avgRating %></span>
                                    <div class="stars">
                                        <i class="bi bi-star-fill"></i>
                                        <i class="bi bi-star-fill"></i>
                                        <i class="bi bi-star-fill"></i>
                                        <i class="bi bi-star-fill"></i>
                                        <i class="bi bi-star-half"></i>
                                    </div>
                                    <span class="rating-count"><%= reviews ? reviews.length : '0' %> değerlendirme</span>
                                </div>
                            </div>
                        </div>

                        <div class="reviews-list">
                            <% if (reviews && reviews.length > 0) { %>
                                <% reviews.forEach(review => { %>
                                    <div class="review-item">
                                        <div class="review-header">
                                            <div class="reviewer-info">
                                                <div class="reviewer-avatar">
                                                    <i class="bi bi-person-circle"></i>
                                                </div>
                                                <div class="reviewer-details">
                                                    <h5><%= review.user.email.split('@')[0] %></h5>
                                                    <div class="review-rating">
                                                        <% for(let i = 0; i < review.rating; i++) { %>
                                                            <i class="bi bi-star-fill"></i>
                                                        <% } %>
                                                        <% for(let i = review.rating; i < 5; i++) { %>
                                                            <i class="bi bi-star"></i>
                                                        <% } %>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="review-date">
                                                <%= new Date(review.createdAt).toLocaleDateString('tr-TR') %>
                                            </div>
                                        </div>
                                        <div class="review-content">
                                            <p><%= review.comment %></p>
                                        </div>
                                    </div>
                                <% }); %>
                            <% } else { %>
                                <div class="no-reviews">
                                    <i class="bi bi-star"></i>
                                    <h4>Henüz değerlendirme yok</h4>
                                    <p>Bu ürün için ilk değerlendirmeyi siz yapın!</p>
                                </div>
                            <% } %>
                        </div>
                    </div>
                </div>

                <!-- Shipping Tab -->
                <div class="tab-pane" id="shipping">
                    <div class="tab-content-inner">
                        <h3>Kargo & Teslimat Bilgileri</h3>
                        <div class="shipping-info">
                            <div class="shipping-item">
                                <i class="bi bi-truck text-primary"></i>
                                <div>
                                    <h5>Ücretsiz Kargo</h5>
                                    <p>500₺ ve üzeri alışverişlerde ücretsiz kargo</p>
                                </div>
                            </div>
                            <div class="shipping-item">
                                <i class="bi bi-clock text-info"></i>
                                <div>
                                    <h5>Hızlı Teslimat</h5>
                                    <p>1-3 iş günü içinde teslimat</p>
                                </div>
                            </div>
                            <div class="shipping-item">
                                <i class="bi bi-shield-check text-success"></i>
                                <div>
                                    <h5>Güvenli Paketleme</h5>
                                    <p>Özel paketleme ile güvenli teslimat</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Related Products -->
        <div class="related-products">
            <h3>Benzer Ürünler</h3>
            <div class="products-grid">
                <!-- Related products will be loaded here -->
                <div class="product-card tech-card">
                    <div class="product-image">
                        <img src="<%= urun.resim %>" alt="Benzer Ürün" loading="lazy">
                        <div class="product-overlay">
                            <a href="/product/<%= urun._id %>" class="btn btn-primary">
                                <i class="bi bi-eye"></i>
                                <span>Detayları Gör</span>
                            </a>
                        </div>
                    </div>
                    <div class="product-info">
                        <h4>Silver Wyandotte Horoz</h4>
                        <div class="product-price">₺3.000,00</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Image Modal -->
<div class="image-modal" id="imageModal">
    <div class="modal-overlay" onclick="closeImageModal()">
        <div class="modal-content">
            <button class="close-btn" onclick="closeImageModal()">&times;</button>
            <img src="" alt="" id="modalImage">
        </div>
    </div>
</div>

<%- include('partials/footer') %>